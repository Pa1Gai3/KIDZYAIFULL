import{c as j,r as o,R as K,j as e,a as O,b as L,d as Q,S as W}from"./index-W2rP_A9A.js";import{P as X}from"./PaymentModal-DNwPN9aS.js";import{D as Z,R as ee}from"./refresh-cw-CsxKXGEf.js";import{G as te}from"./grid-3x3-DKWlmmJu.js";import"./lock-CYEKKvdY.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=j("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=j("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=j("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),me=({story:m,paperSize:v,characterDescription:g,isPurchasedExternal:z,onBack:b,onSave:N})=>{const[r,h]=o.useState(m),[c,y]=o.useState(0),[k,C]=o.useState(!1),[re,ne]=o.useState(!0),[A,w]=o.useState(!1),[p,F]=o.useState(z),[f,P]=o.useState(!1),[x,D]=o.useState([]),[S,G]=o.useState(!1),n=r.pages[c],I=K.useRef(!1);o.useEffect(()=>{(async()=>{if(I.current)return;I.current=!0;const s=m.pages[0].imageUrl;for(let a=1;a<m.pages.length;a++)if(!m.pages[a].imageUrl){h(l=>({...l,pages:l.pages.map((i,d)=>d===a?{...i,isLoadingImage:!0}:i)}));try{const l=m.pages[a],{lineArt:i}=await L(l.imagePrompt,v,g,s);h(d=>({...d,pages:d.pages.map((u,J)=>J===a?{...u,imageUrl:i,isLoadingImage:!1}:u)})),await new Promise(d=>setTimeout(d,1e3))}catch(l){console.error(`Failed to generate page ${a}`,l),h(i=>({...i,pages:i.pages.map((d,u)=>u===a?{...d,isLoadingImage:!1}:d)}))}}})()},[]);const M=()=>{c<r.pages.length-1?y(t=>t+1):P(!0)},q=()=>{f?P(!1):c>0&&y(t=>t-1)},U=async()=>{if(!n.isCover){C(!0);try{const t=r.pages[0].imageUrl,{lineArt:s}=await L(n.imagePrompt,v,g,t);h(a=>({...a,pages:a.pages.map((l,i)=>i===c?{...l,imageUrl:s,referenceImageUrl:""}:l)}))}finally{C(!1)}}},R=async()=>{if(x.length>0)return x;G(!0);try{const t=r.pages[0].imageUrl||"",s=[];t&&s.push(t);for(let a=1;a<r.pages.length;a++){const l=r.pages[a];if(l.imageUrl){const i=await Q(l.imageUrl,t||"",l.imagePrompt);s.push(i)}}return D(s),s}catch(t){return console.error("Failed to generate color grid",t),alert("Failed to generate the color guide. Please try again."),[]}finally{G(!1)}},$=t=>{h(s=>({...s,pages:s.pages.map((a,l)=>l===c?{...a,text:t}:a)}))},E=async()=>{if(!p){w(!0);return}x.length===0&&(await R(),await new Promise(t=>setTimeout(t,1e3))),window.print()},H=async()=>{w(!1),F(!0);try{await N(r,!0),alert("Payment Successful! Story saved to your Library."),b()}catch(t){console.error("Auto-save failed",t),b()}},T=()=>e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-brand-600 to-purple-800 text-white flex flex-col items-center justify-center p-8 relative overflow-hidden print:bg-white print:text-black",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10 print:hidden"}),e.jsxs("div",{className:"z-10 text-center w-full max-w-2xl flex flex-col items-center h-full justify-between py-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl md:text-6xl font-display font-bold leading-tight mb-4 text-yellow-300 drop-shadow-lg print:text-black print:drop-shadow-none",children:r.title}),e.jsx("p",{className:"text-xl text-white/90 font-light tracking-widest uppercase print:text-black",children:"A Personalized Coloring Adventure"})]}),e.jsx("div",{className:"relative my-6 w-full flex-1 flex items-center justify-center min-h-0",children:e.jsx("div",{className:"relative p-2 bg-white/10 rounded-2xl backdrop-blur-sm shadow-2xl inline-block max-h-full print:shadow-none print:border-0",children:e.jsx("img",{src:n.imageUrl,alt:"Cover",className:"rounded-xl shadow-lg max-h-[50vh] md:max-h-[60vh] w-auto object-contain border-4 border-white/20 print:border-0 print:shadow-none"})})}),e.jsx("div",{className:"bg-white/20 backdrop-blur-md px-8 py-3 rounded-full mt-4 print:hidden",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center",children:[e.jsx("span",{className:"mr-2",children:"⭐"})," ",n.text," ",e.jsx("span",{className:"ml-2",children:"⭐"})]})}),e.jsx("div",{className:"hidden print:block text-xl font-bold mt-4",children:n.text})]})]}),V=()=>e.jsxs("div",{className:"flex-1 flex flex-col h-full print:block print:h-screen print:w-screen print:overflow-hidden print-page-break relative bg-white",children:[e.jsxs("div",{className:"relative flex-1 flex items-center justify-center p-4 min-h-0 bg-slate-50 border-b border-slate-100 print:bg-white print:border-0 print:h-[75%]",children:[n.isLoadingImage||k?e.jsxs("div",{className:"flex flex-col items-center text-slate-400 print:hidden",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-500 mb-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Drawing Line Art..."})]}):n.imageUrl?e.jsx("div",{className:"relative h-full w-full flex items-center justify-center",children:e.jsx("img",{src:n.imageUrl,alt:"Coloring Page",className:"max-h-full max-w-full object-contain drop-shadow-sm print:drop-shadow-none"})}):e.jsxs("div",{className:"text-red-400 text-center p-4 print:hidden",children:[e.jsx("p",{children:"Failed to load image."}),e.jsx("button",{onClick:U,className:"text-brand-500 underline mt-2",children:"Retry"})]}),e.jsx("div",{className:"absolute bottom-4 right-4 flex space-x-2 print:hidden z-20",children:e.jsx("button",{onClick:U,className:"bg-white p-2 rounded-full shadow-md border border-slate-200 text-slate-500 hover:text-brand-600 transition hover:scale-110",title:"Regenerate Image",children:e.jsx(ee,{size:18,className:k?"animate-spin":""})})})]}),e.jsxs("div",{className:"bg-white p-6 md:p-8 flex flex-col justify-center items-center text-center shrink-0 print:h-[25%] print:p-4",children:[e.jsx("div",{className:"mb-2 print:hidden w-full flex justify-between",children:e.jsxs("span",{className:"text-xs font-bold tracking-widest text-slate-300 uppercase",children:["Page ",c+1]})}),e.jsx("textarea",{value:n.text,onChange:t=>$(t.target.value),className:"w-full text-2xl md:text-3xl font-display leading-snug text-slate-800 outline-none resize-none bg-transparent text-center border-none p-0 focus:ring-0 placeholder-slate-200 print:hidden",rows:3}),e.jsx("div",{className:"hidden print:block text-2xl font-display leading-relaxed text-slate-900 px-8",children:n.text})]})]}),B=()=>e.jsxs("div",{className:"w-full h-full bg-slate-50 overflow-y-auto p-4 md:p-8 flex flex-col items-center print:h-screen print:w-screen print:p-0 print:bg-white",children:[e.jsxs("div",{className:"max-w-4xl w-full text-center mb-6 print:mb-4",children:[e.jsx("h2",{className:"text-3xl font-display font-bold text-slate-800 mb-2 print:text-2xl",children:"Magic Color Guide"}),e.jsx("p",{className:"text-slate-600 print:hidden",children:"Here is your reference for coloring the story!"})]}),x.length===0?e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center p-8 bg-white rounded-3xl shadow-xl max-w-md mx-auto print:hidden",children:[e.jsx(W,{className:"w-16 h-16 text-brand-500 mx-auto mb-4 animate-pulse"}),e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Reveal the Colors!"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Create a magical color reference sheet based on your story's artwork."}),e.jsx("button",{onClick:R,disabled:S,className:"w-full bg-brand-600 text-white font-bold py-3 px-6 rounded-xl hover:bg-brand-700 transition flex items-center justify-center",children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white/50 border-r-white mr-2"}),"Painting Magic..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"mr-2"}),"Generate Color Guide"]})})]})}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 w-full max-w-5xl print:grid-cols-3 print:gap-2",children:x.map((t,s)=>e.jsx("div",{className:"bg-white p-2 rounded-xl shadow-md border border-slate-100 print:shadow-none print:border-0 break-inside-avoid",children:e.jsxs("div",{className:"aspect-square rounded-lg overflow-hidden bg-slate-50 mb-2 relative",children:[e.jsx("img",{src:t,alt:`Scene ${s}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute bottom-0 left-0 bg-black/60 text-white text-[10px] p-1 rounded-tr-lg font-bold",children:s===0?"Cover":`Page ${s}`})]})},s))})]}),Y=()=>e.jsxs("div",{className:"hidden print:block w-full h-auto bg-white text-black",children:[e.jsxs("div",{className:"w-[297mm] h-[210mm] flex flex-col items-center justify-center p-12 text-center",style:{pageBreakAfter:"always"},children:[e.jsx("h1",{className:"text-6xl font-display font-bold text-slate-900 mb-8",children:r.title}),e.jsx("div",{className:"w-full max-w-lg aspect-square mb-8",children:e.jsx("img",{src:r.pages[0].imageUrl,className:"w-full h-full object-contain rounded-xl"})}),e.jsxs("p",{className:"text-2xl font-sans text-slate-500 uppercase tracking-widest",children:["A Story for ",g.split(" ")[0]||"You"]})]}),r.pages.filter(t=>!t.isCover).map((t,s)=>e.jsxs("div",{className:"w-[297mm] h-[210mm] flex items-center justify-between p-16 gap-12",style:{pageBreakAfter:"always"},children:[e.jsx("div",{className:"w-1/2 h-full flex items-center justify-center border-4 border-slate-900 rounded-2xl p-4 bg-white",children:e.jsx("img",{src:t.imageUrl,className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{className:"w-1/2 h-full flex flex-col justify-center",children:[e.jsx("div",{className:"text-4xl font-display leading-relaxed text-slate-800",children:t.text}),e.jsxs("div",{className:"mt-8 text-slate-400 font-bold uppercase tracking-widest text-sm",children:["Page ",s+1]})]})]},s)),e.jsxs("div",{className:"w-[297mm] h-[210mm] flex flex-col items-center justify-center p-12",style:{pageBreakAfter:"auto"},children:[e.jsx("h2",{className:"text-4xl font-display font-bold mb-8",children:"Color Guide"}),e.jsx("div",{className:"grid grid-cols-3 gap-6 w-full max-w-5xl",children:x.length>0?x.map((t,s)=>e.jsx("div",{className:"aspect-square rounded-xl overflow-hidden border border-slate-200 shadow-sm relative",children:e.jsx("img",{src:t,className:"w-full h-full object-cover"})},s)):e.jsx("div",{className:"col-span-3 text-center text-slate-400",children:"Color guide not generated."})})]})]}),_=()=>f?B():n.isCover?T():V();return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 h-[calc(100vh-64px)] flex flex-col print:h-auto print:w-full print:p-0",children:[Y(),e.jsxs("div",{className:"w-full h-full flex flex-col print:hidden",children:[A&&e.jsx(X,{itemLabel:"Digital Storybook PDF",price:99,onClose:()=>w(!1),onSuccess:H}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-4 shrink-0 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:b,className:"text-slate-500 hover:text-slate-800 font-medium",children:"← Library"}),e.jsx("h1",{className:"text-xl md:text-2xl font-display font-bold text-brand-900 truncate max-w-md",children:r.title})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>N(r,p),className:"bg-brand-100 hover:bg-brand-200 text-brand-700 px-4 py-2 rounded-xl font-bold flex items-center text-sm transition",children:[e.jsx(le,{size:16,className:"mr-2"}),"Save to Library"]}),e.jsxs("button",{onClick:E,className:"bg-brand-600 hover:bg-brand-700 text-white border border-transparent px-4 py-2 rounded-xl font-bold flex items-center text-sm shadow-lg shadow-brand-200 transition transform hover:scale-105",children:[p?e.jsx(O,{size:16,className:"mr-2"}):e.jsx(Z,{size:16,className:"mr-2"}),p?"Print / Download PDF":"Download PDF (₹99)"]})]})]}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:e.jsxs("div",{className:"flex-1 bg-white rounded-3xl shadow-2xl border border-slate-200 overflow-hidden flex flex-col relative",children:[_(),e.jsxs("div",{className:"bg-slate-50 p-4 flex items-center justify-between border-t border-slate-200 shrink-0 z-20",children:[e.jsx("button",{onClick:q,className:"p-3 rounded-full hover:bg-white hover:shadow-md disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:shadow-none transition text-slate-700",children:e.jsx(se,{size:24})}),e.jsxs("div",{className:"flex space-x-2 overflow-x-auto px-2",children:[r.pages.map((t,s)=>e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${!f&&s===c?"w-8 bg-brand-500":"w-2 bg-slate-300"}`},s)),e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${f?"w-8 bg-brand-500":"w-2 bg-slate-300"}`,title:"Color Guide"})]}),e.jsx("button",{onClick:M,disabled:f,className:"p-3 rounded-full hover:bg-white hover:shadow-md disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:shadow-none transition text-slate-700",children:e.jsx(ae,{size:24})})]})]})})]})]})};export{me as default};
